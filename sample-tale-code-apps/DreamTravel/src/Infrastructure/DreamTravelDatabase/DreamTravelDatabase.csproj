<Project Sdk="MSBuild.Sdk.SqlProj/3.2.0">
	<PropertyGroup>
		<Name>DreamTravelDatabase</Name>
		<SqlServerVersion>SqlAzure</SqlServerVersion>
		<AppendTargetFrameworkToOutputPath>false</AppendTargetFrameworkToOutputPath>
		<DSP>Microsoft.Data.Tools.Schema.Sql.SqlAzureV12DatabaseSchemaProvider</DSP>
	</PropertyGroup>

	<ItemGroup>
		<None Update="_Deployment\default.publish.xml">
			<CopyToOutputDirectory>Always</CopyToOutputDirectory>
		</None>
	</ItemGroup>

	<!-- Skopiuj dacpac do wspólnej lokalizacji po zbudowaniu -->
	<Target Name="CopyDacpacToSharedLocation" AfterTargets="Build">
		<PropertyGroup>
			<DreamTravelRoot>$(MSBuildProjectDirectory)\..\..\..</DreamTravelRoot>
			<SharedDacpacDir>$(DreamTravelRoot)\artifacts\dacpac\</SharedDacpacDir>
			<SharedDacpacPath>$(SharedDacpacDir)$(MSBuildProjectName).dacpac</SharedDacpacPath>
		</PropertyGroup>

		<MakeDir Directories="$(SharedDacpacDir)" />

		<Copy
				SourceFiles="$(TargetDir)$(MSBuildProjectName).dacpac"
				DestinationFiles="$(SharedDacpacPath)"
				SkipUnchangedFiles="true" />

		<Message Text="✅ Dacpac copied to: $(SharedDacpacPath)" Importance="high" />
	</Target>

</Project>